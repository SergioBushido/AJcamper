---
const { t } = Astro.props as { t:any };
const images = [
  { src: '/images/interior-1.jpg', alt: 'Interior 1' },
  { src: '/images/interior-2.jpg', alt: 'Interior 2' },
  { src: '/images/exterior-1.jpg', alt: 'Exterior 1' },
  { src: '/images/exterior-2.jpg', alt: 'Exterior 2' },
  { src: '/images/interior-3.jpg', alt: 'Interior 3' },
  { src: '/images/exterior-3.jpg', alt: 'Exterior 3' },
  { src: '/images/interior-4.jpg', alt: 'Interior 4' },
  { src: '/images/exterior-4.jpg', alt: 'Exterior 4' },
];
---

<section id="gallery" class="container" aria-label={t.gallery_title}>
  <h2 class="section-title">{t.gallery_title}</h2>
  <div class="gallery">
    {images.map((img) => (
      <figure class="card" tabindex="0">
        <img src={img.src} alt={img.alt} loading="lazy" decoding="async" />
      </figure>
    ))}
  </div>

  <dialog id="lightbox" aria-label="Vista ampliada de la imagen">
    <button class="close-btn" aria-label="Cerrar">âœ•</button>
    <img id="lightbox-img" alt="" />
  </dialog>
</section>

<script is:inline>
  const dlg = document.getElementById('lightbox');
  const dlgImg = document.getElementById('lightbox-img');
  const closeBtn = dlg.querySelector('.close-btn');

  const supportsDialog = typeof HTMLDialogElement === 'function'
    && typeof dlg.showModal === 'function';

  function openLightbox(src, alt='') {
    dlgImg.src = src;
    dlgImg.alt = alt;
    if (supportsDialog) dlg.showModal();
    else dlg.setAttribute('open', '');
  }

  function closeLightbox() {
    if (supportsDialog && dlg.open) dlg.close();
    dlg.removeAttribute('open');
    dlgImg.removeAttribute('src');
  }

  document.querySelectorAll('.gallery .card img').forEach(img => {
    img.addEventListener('click', () => openLightbox(img.currentSrc || img.src, img.alt));
    img.closest('.card')?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openLightbox(img.currentSrc || img.src, img.alt);
      }
    });
  });

  closeBtn.addEventListener('click', closeLightbox);
  dlg.addEventListener('click', (e) => {
    const r = dlgImg.getBoundingClientRect();
    const outside = e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom;
    if (outside) closeLightbox();
  });
  dlgImg.addEventListener('click', closeLightbox);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeLightbox(); });
</script>
